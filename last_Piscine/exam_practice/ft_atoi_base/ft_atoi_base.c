#include <stdbool.h>

bool    char_in_base(char   c, char* base)
{
    while (*base)
    {
        if (*base == c)
            return (true);
        base++;
    }
    return(false);
}

bool    check_base_characters(char  *base)
{
    int i;

    i = 0;
    while (base[i])
    {
        if (base[i] == '+' || base[i] == '-' || base[i] <= ' ')
            return (false);
        i++;
    }
    return (true);
}

bool    has_duplicate_chars(char *base)
{
    int i;
    int j;

    i = 0;
    while (base[i])
    {
        j = i + 1;
        while (base[j])
        {
            if (base[j] == base[i])
                return (true);
            j++;
        }
        i++;
    }
    return (false);
}

bool    is_valid_base(char* base)
{
    if (!base[0] || (base[0] && !base[1]))// 空文字　or 1文字は無効と判定する
        return (false);
    if (!check_base_characters(base))// 基数に含まれる文字は、'+'、'-'、または空白文字（スペース、タブなど）を含めることはできないと判定　「含んでいない」が！なので、「含んでいる」ということになる
        return (false);
    if (has_duplicate_chars(base))//重複している場合、偽。　具体例: 無効な基数: "011"。ここでは、1 が2回出現しています。無効な基数: "AABCD"。この基数では、A が2回出現しています。
        return (false);
    return (true);
}

int ft_atoi_base(char*  str, char   *base)
{
    int sign;
    int result;
    int base_len;
    int i;
    int j;

    sign = 1;
    result = 0;
    base_len = 0;
    i = 0;
    if (!is_valid_base(base))
        return (0);
    while (base[i])
        i++;
    base_len = i;
    while (*str <= ' ')
        str++;
    if (*str == '-' || *str == '+')
        sign = (*str++ == '-') ? -1 : 1;
    while (char_in_base(*str, base))
    {
        j = 0;
        while (base[j] && (base[j] != *str))
            j++;
        result = result * base_len + j;
        str++;
    }
    return (result * sign);
}


/*プログラム概要
このプログラムの ft_atoi_base 関数は与えられた文字列を特定の基数（進数）で表された数値として解釈し、
その結果を10進数（基数10）の整数値として返します。

この関数は、入力された数値の文字列が任意の基数で表されていると仮定し、
それを10進数の数値に変換する役割を果たします。
したがって、関数の出力は常に10進数で表されます。
*/

/*プログラム要件
このプログラムは、与えられた文字列を特定の基数（base）で表された数として解釈し、
その数値を10進数で返す関数 ft_atoi_base を含んでいます。
基数（または進数）とは、数を表すのに用いる数字のセットのことで、
例えば10進数は基数が10で、0から9までの数字を使用します。
この関数は、任意の基数で表された数を10進数に変換することができますが、
いくつかの要件と制約があります。

主な機能とチェックポイント
is_valid_base 関数:

基数（base）が有効かどうかをチェックします。
基数は最低2文字以上必要です（1文字だけや空の場合は無効）。
基数に含まれる文字には、'+'、'-'、または空白文字（スペース、タブなど）を含めることはできません。
基数内に重複する文字があってはなりません。

ft_atoi_base 関数:

文字列 str を基数 base で表された数値として解釈し、その10進数での値を計算して返します。
文字列の前にある空白を無視します。
数値の前に '+' または '-' がある場合は、それぞれ正または負の符号として扱います。
基数が有効でない場合、関数は0を返します。
文字列内の各文字が基数に含まれるかどうかをチェックし、含まれている場合はその文字に相当する数値を計算に使用します。
基数内での文字の位置を基に数値を計算し、最終的な結果を符号付きで返します。
要件と制約
基数の有効性: 基数は一意の文字セットでなければならず、特定の制限（'+'、'-'、空白の禁止、最低2文字必要）を満たしている必要があります。
入力文字列: 数値の前後の空白は無視され、先頭の符号は数値の符号として解釈されます。数値以外の文字が現れた時点で、その数値の解析は終了します。
この関数は、カスタム基数（例えば2進数、16進数など）で表された文字列を10進数の整数に変換するために使用されます。これにより、異なる数値表現形式間の変換が可能になります。
*/



/* ft_atoi_baseの進数変換のロジック

16進数の各桁は、その位置に応じて16のべき乗を基にした値を持ちます。
最も右の桁は16の0乗（1）を表し、左に一つ移動するごとにそのべき乗は一つずつ上がります
（次の桁は16の1乗、その次は16の2乗と続きます）。

例: "2A"を16進数から10進数に変換
"2A"の"A"は、16進数で10を意味し、最も右の桁に位置するため、16の0乗を乗算します。つまり、10 * 16の0乗 = 10です。
"2"は左隣の桁にあり、16の1乗を乗算します。つまり、2 * 16の1乗 = 32です。

これらを合計すると、"2A"の10進数での値は42になります。

*一般化した変換の説明
一般的な16進数から10進数への変換式は以下のようになります。

10進数の値 = (dn * 16のn乗) + (dn-1 * 16の(n-1)乗) + ... + (d1 * 16の1乗) + (d0 * 16の0乗)

ここで、diは各桁の16進数の値（0から15まで）、nは数値の桁数から1を引いたものです。

例: "1F4"を16進数から10進数に変換
"1F4"の"4"は、16の0乗を乗算し、4 * 16の0乗 = 4です。
"F"は15を意味し、16の1乗を乗算します。15 * 16の1乗 = 240です。
最も左の"1"は、16の2乗を乗算します。1 * 16の2乗 = 256です。
これらを合計すると、"1F4"の10進数での値は500になります。

このように、16進数の値を10進数に変換する際は、各桁の値にその桁が表す16のべき乗を乗算し、それらの合計を求めます。

*/